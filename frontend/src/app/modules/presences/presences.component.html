<div class="presences-container">
  <div class="header">
    <h1>Gestion des Présences</h1>
    <button class="btn-primary" (click)="refreshData()">
      <span class="material-icons">refresh</span>
      Actualiser
    </button>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">
        <span class="material-icons">timeline</span>
      </div>
      <div class="stat-content">
        <h2>{{ stats.totalPresences }}</h2>
        <p>Total Pointages</p>
      </div>
    </div>

    <div class="stat-card present">
      <div class="stat-icon">
        <span class="material-icons">check_circle</span>
      </div>
      <div class="stat-content">
        <h2>{{ stats.presentsToday }}</h2>
        <p>Présents Aujourd'hui</p>
      </div>
    </div>

    <div class="stat-card absent">
      <div class="stat-icon">
        <span class="material-icons">cancel</span>
      </div>
      <div class="stat-content">
        <h2>{{ stats.absentsToday }}</h2>
        <p>Absents Aujourd'hui</p>
      </div>
    </div>

    <div class="stat-card retard">
      <div class="stat-icon">
        <span class="material-icons">schedule</span>
      </div>
      <div class="stat-content">
        <h2>{{ stats.retardsToday }}</h2>
        <p>Retards Aujourd'hui</p>
      </div>
    </div>
  </div>

  <!-- Presences Table -->
  <div class="table-container">
    <div class="table-header">
      <h2>Historique des Présences</h2>
      <div class="search-container">
        <mat-form-field appearance="outline">
          <mat-label>Rechercher</mat-label>
          <input matInput (keyup)="applyFilter($event)" placeholder="Nom, date, statut...">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
      </div>
    </div>

    <div class="loading-container" *ngIf="isLoading">
      <mat-spinner diameter="50"></mat-spinner>
    </div>

    <table mat-table [dataSource]="dataSource" matSort class="presences-table" *ngIf="!isLoading">
      <!-- Employee Name Column -->
      <ng-container matColumnDef="employeeName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Employé</th>
        <td mat-cell *matCellDef="let presence">{{ presence.employeeName }}</td>
      </ng-container>

      <!-- Date Column -->
      <ng-container matColumnDef="datePresence">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Date</th>
        <td mat-cell *matCellDef="let presence">{{ presence.datePresence | date:'dd/MM/yyyy' }}</td>
      </ng-container>

      <!-- Entry Time Column -->
      <ng-container matColumnDef="heureEntree">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Entrée</th>
        <td mat-cell *matCellDef="let presence">{{ presence.heureEntree || '-' }}</td>
      </ng-container>

      <!-- Exit Time Column -->
      <ng-container matColumnDef="heureSortie">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Sortie</th>
        <td mat-cell *matCellDef="let presence">{{ presence.heureSortie || '-' }}</td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="statut">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Statut</th>
        <td mat-cell *matCellDef="let presence">
          <span class="status-chip" [ngClass]="getStatusClass(presence.statut)">
            {{ getStatusLabel(presence.statut) }}
          </span>
        </td>
      </ng-container>

      <!-- Absence Reason Column -->
      <ng-container matColumnDef="motifAbsence">
        <th mat-header-cell *matHeaderCellDef>Motif d'Absence</th>
        <td mat-cell *matCellDef="let presence">{{ presence.motifAbsence || '-' }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>

    <div *ngIf="dataSource.data.length === 0 && !isLoading" class="empty-state">
      <span class="material-icons">event_note</span>
      <p>Aucune présence trouvée</p>
    </div>
  </div>
</div>
