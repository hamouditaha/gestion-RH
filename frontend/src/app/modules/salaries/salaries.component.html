<div class="salaries-container">
  <div class="header">
    <h1>Gestion des Salaires</h1>
    <div class="header-actions">
      <button class="btn-secondary" (click)="refreshData()">
        <span class="material-icons">refresh</span>
        Actualiser
      </button>
      <button class="btn-primary" (click)="calculateSalaries()">
        <span class="material-icons">calculate</span>
        Calculer Salaires
      </button>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">
        <span class="material-icons">receipt</span>
      </div>
      <div class="stat-content">
        <h2>{{ stats.totalBulletins }}</h2>
        <p>Total Bulletins</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <span class="material-icons">euro</span>
      </div>
      <div class="stat-content">
        <h2>{{ stats.totalSalaries | number:'1.0-0' }}€</h2>
        <p>Masse Salariale</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <span class="material-icons">trending_up</span>
      </div>
      <div class="stat-content">
        <h2>{{ stats.averageSalary | number:'1.0-0' }}€</h2>
        <p>Salaire Moyen</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <span class="material-icons">calendar_month</span>
      </div>
      <div class="stat-content">
        <h2>{{ stats.currentMonthBulletins }}</h2>
        <p>Bulletins Ce Mois</p>
      </div>
    </div>
  </div>

  <!-- Salaries Table -->
  <div class="table-container">
    <div class="table-header">
      <h2>Bulletins de Salaire</h2>
      <div class="search-container">
        <mat-form-field appearance="outline">
          <mat-label>Rechercher</mat-label>
          <input matInput (keyup)="applyFilter($event)" placeholder="Nom, mois, année...">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
      </div>
    </div>

    <div class="loading-container" *ngIf="isLoading">
      <mat-spinner diameter="50"></mat-spinner>
    </div>

    <table mat-table [dataSource]="dataSource" matSort class="salaries-table" *ngIf="!isLoading">
      <!-- Employee Name Column -->
      <ng-container matColumnDef="employeeName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Employé</th>
        <td mat-cell *matCellDef="let bulletin">{{ bulletin.employeeName }}</td>
      </ng-container>

      <!-- Month Column -->
      <ng-container matColumnDef="mois">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Mois</th>
        <td mat-cell *matCellDef="let bulletin">{{ getMonthName(bulletin.mois) }}</td>
      </ng-container>

      <!-- Year Column -->
      <ng-container matColumnDef="annee">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Année</th>
        <td mat-cell *matCellDef="let bulletin">{{ bulletin.annee }}</td>
      </ng-container>

      <!-- Base Salary Column -->
      <ng-container matColumnDef="salaireBase">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Salaire Base</th>
        <td mat-cell *matCellDef="let bulletin">{{ bulletin.salaireBase | number:'1.2-2' }}€</td>
      </ng-container>

      <!-- Net Salary Column -->
      <ng-container matColumnDef="salaireNet">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Salaire Net</th>
        <td mat-cell *matCellDef="let bulletin" class="salary-net">{{ bulletin.salaireNet | number:'1.2-2' }}€</td>
      </ng-container>

      <!-- Generation Date Column -->
      <ng-container matColumnDef="dateGeneration">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Date Génération</th>
        <td mat-cell *matCellDef="let bulletin">{{ bulletin.dateGeneration | date:'dd/MM/yyyy' }}</td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let bulletin">
          <button mat-icon-button (click)="viewBulletin(bulletin)" title="Voir Bulletin">
            <mat-icon>visibility</mat-icon>
          </button>
          <button mat-icon-button (click)="sendBulletinByEmail(bulletin)" title="Envoyer par Email">
            <mat-icon>email</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>

    <div *ngIf="dataSource.data.length === 0 && !isLoading" class="empty-state">
      <span class="material-icons">receipt_long</span>
      <p>Aucun bulletin de salaire trouvé</p>
      <button class="btn-primary" (click)="calculateSalaries()">Calculer les salaires</button>
    </div>
  </div>
</div>
